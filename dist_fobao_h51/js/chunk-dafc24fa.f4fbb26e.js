(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-dafc24fa"],{"2c12":function(s,i,t){"use strict";t("4e3f");var e=function(){var s=this,i=s._self._c;return i("div",{staticClass:"goods-wrap"},[i("modalGoodsSku",{ref:"modalGoodsSku"}),s.list.length?i("div",{staticClass:"goods-list"},[i("van-list",{attrs:{finished:s.finished,"finished-text":"没有更多了~"},on:{load:s.queryGoodsList},model:{value:s.loading,callback:function(i){s.loading=i},expression:"loading"}},[i("div",{staticClass:"list list-goods"},s._l(s.list,(function(t,e){return i("div",{key:e,staticClass:"item",on:{click:function(i){return s.$router.push("/goodsDetail?id="+t.inventoryId)}}},[i("div",{staticClass:"img-box"},[i("img",{staticClass:"full product-img cover",attrs:{src:t.img}})]),i("div",{staticClass:"info-box"},[i("div",{staticClass:"title"},[s._v(s._s(t.title))]),i("div",{staticClass:"guige"},[i("span",[s._v(" "+s._s(s._f("f_guige")(t.key_vals))+" ")])]),i("div",{staticClass:"price-box"},[i("div",{staticClass:"left"},[i("div",{staticClass:"price-sale"},[i("span",{staticClass:"currency"},[s._v("￥")]),s._v(s._s(t.price_sale)+" ")])]),i("div",{staticClass:"cart-box"},[i("van-icon",{attrs:{name:"shopping-cart-o"}})],1)])])])})),0)])],1):i("div",{staticClass:"empty-container"},[[s.finished?i("van-empty",{staticClass:"custom-image",attrs:{description:"没有查询到商品信息"}}):s._e()]],2)],1)},c=[],a=t("a2ed"),n=t("7736"),o={name:"search-goods-list",props:["params"],components:{modalGoodsSku:a["a"]},data(){return{list:[],finished:!1,loading:!1,timer:null,pagination:{page:1,pagenum:10}}},computed:{...Object(n["b"])([""])},watch:{params(s,i){this.setView()}},created(){this.setView()},methods:{setView(){this.init(),this.queryGoodsList()},init(){this.pagination.page=1,this.finished=!1,this.list=[]},goodsToCart(s){console.log({...s}),this.mix_shopcart_add_goods({inventoryId:s.inventoryId,add_num:1})},queryGoodsList(){"classify"!=this.$route.name||this.params.channel_id?this.$api("product_plist",{...this.params,...this.pagination}).then(s=>{let{code:i,data:t,pages:e,message:c}=s;1==i&&(e<=this.pagination.page?this.finished=!0:this.finished=!1,t.forEach(s=>{s.num=0}),this.list=[...this.list,...t]),this.pagination.page++,this.loading=!1}):console.log(" ======= 分类页面没有传递分类参数 禁止本次查询 =======")}}},l=o,r=(t("310e"),t("0b56")),u=Object(r["a"])(l,e,c,!1,null,"4572672a",null);i["a"]=u.exports},"310e":function(s,i,t){"use strict";t("9f0a")},"9f0a":function(s,i,t){},a2ed:function(s,i,t){"use strict";var e=function(){var s=this,i=s._self._c;return i("div",{staticClass:"modal-sku"},[i("van-popup",{style:{height:"80%"},attrs:{round:"",closeable:"",position:"bottom"},on:{closed:s.onPopClosed},model:{value:s.show_sku,callback:function(i){s.show_sku=i},expression:"show_sku"}},[i("div",{staticClass:"sku-wrap"},[i("div",{staticClass:"sku-inner"},[i("div",{staticClass:"goods-info"},[i("div",{staticClass:"img-box",on:{click:s.previewModalImage}},[i("img",{attrs:{src:s.view_info.image||s.poster,alt:""}})]),i("div",{staticClass:"info-box"},[i("div",{staticClass:"goods-title"},[s._v(" "+s._s(s.curr.title)+" ")]),i("div",{staticClass:"price"},[i("span",{staticClass:"currency"},[s._v("￥")]),s._v(" "+s._s(s.view_info.price_sale))]),i("div",{staticClass:"bianma"},[s._v("商品编码："+s._s(s.curr.sn))]),i("div",{staticClass:"bianma"},[s._v("商品库存："+s._s(s.view_info.kucun))])])]),i("div",{staticClass:"action-box"},["单规格"==s.sku_mode?i("div",{staticClass:"guige-item"},[i("div",{staticClass:"left"},[s._v("规格：")]),i("div",{staticClass:"right"},[i("div",{staticClass:"guige-list"},s._l(s.list_specifications,(function(t,e){return i("div",{key:e,staticClass:"item",class:{active:t.inventoryId==s.select_specifications.inventoryId},on:{click:function(i){return s.toggleSpecifications(t)}}},[s._v(" "+s._s(s._f("f_guige")(t.key_vals))+" ")])})),0)])]):s._e(),"多规格"==s.sku_mode?i("div",{staticClass:"guige-group"},s._l(s.curr.skus,(function(t,e){return i("div",{key:e,staticClass:"loop-item"},[i("div",{staticClass:"loop-title"},[s._v(s._s(t.key))]),i("div",{staticClass:"shuxing-list"},s._l(t.child,(function(e,c){return i("div",{key:c,staticClass:"shuxing-item",class:{active:s.if_shuxing_list_contain(e),out_stock:s.if_out_stock({...e,key:t.key})},on:{click:function(i){return s.onSelectShuXing({...e,key:t.key})}}},[s._v(" "+s._s(e.title)+" ")])})),0)])})),0):s._e(),i("div",{staticClass:"num-item"},[i("div",{staticClass:"left"},[s._v("数量：")]),i("div",{staticClass:"right"},[i("div",{staticClass:"operate"},[i("van-stepper",{attrs:{min:"1",max:s.select_specifications.kucun},model:{value:s.selected_num,callback:function(i){s.selected_num=i},expression:"selected_num"}})],1)])])])]),i("div",{staticClass:"sku-btn-box"},[i("button",{staticClass:"btn-1",on:{click:function(i){return s.detail_action("加入购物车")}}},[s._v("加入购物车")]),i("button",{staticClass:"btn-2",on:{click:function(i){return s.detail_action("立即购买")}}},[s._v("立即购买")])])])])],1)},c=[],a=(t("4e3f"),{name:"modal-goods-sku",data(){return{id:"",show_sku:!1,sku_mode:"单规格",select_specifications:{},selected_num:1,list_specifications:[],select_shuxing_list:[],curr:{}}},computed:{view_info(){let s=this.curr;return this.select_specifications.inventoryId&&(s=this.select_specifications),s},poster(){let s="";return this.curr.images&&this.curr.images.length&&(s=this.curr.images[0]),s}},watch:{show_sku(s){}},created(){},beforeDestroy(){this.initState()},methods:{onPopClosed(){console.log("关闭弹层"),this.initState()},initState(){this.id="",this.select_specifications={},this.selected_num=1,this.list_specifications=[],this.select_shuxing_list=[],this.curr={}},init(s){console.log("查看商品规格信息",s),this.show_sku=!0,this.id=s,this.query_detail()},query_detail(){this.$api("product_detail",{inventoryId:this.id}).then(s=>{this.$loading.hide();let{code:i,data:t}=s;1==i&&(this.curr=t,this.swiperImgs=t.images,this.posterSrc=t.images[0],this.comments=t.comment_list,this.coutnt_comments=t.comment_num,this.set_specifications(t),this.list_coupon=this.mix_format_list_coupon(t.yhq_list))})},set_specifications(s){let i=[];s.inventorys&&s.inventorys.length?s.inventorys.forEach(s=>{i.push({...s,key_vals:s.key_vals})}):i=[{inventoryId:this.curr.inventoryId,key_vals:"无"==this.curr.key_vals?"默认":this.curr.key_vals,kucun:this.curr.kucun,price_market:this.curr.price_market,price_sale:this.curr.price_sale,price_shequ_tuan:this.curr.price_shequ_tuan,price_tuan:this.curr.price_tuan,price_user:this.curr.price_user}],1==i.length&&(this.select_specifications=i[0]),this.list_specifications=i;let t=s.skus||{};if(t&&Object.keys(t).length){this.sku_mode="多规格";let s=[];Object.keys(t).forEach(i=>{s.push({key:t[i].key})}),console.log("商品规格默认 select_shuxing_list",s),this.select_shuxing_list=s}else this.sku_mode="单规格"},onSelectShuXing(s){if(console.log("商品属性选择",{...s}),this.if_out_stock(s))return;let i=s.key,t=this.select_shuxing_list.findIndex(i=>i.id==s.id);if(t<0){let t=this.select_shuxing_list.find(s=>s.key==i),e=this.select_shuxing_list.findIndex(s=>s.key==i);t?this.select_shuxing_list.splice(e,1,s):this.select_shuxing_list.push(s)}else this.select_shuxing_list.splice(t,1,{key:i});this.set_select_specifications()},set_select_specifications(){if(Object.keys(this.curr.skus).length==this.select_shuxing_list.length){let s=this.select_shuxing_list.map(s=>s.id).join("-");this.select_specifications=this.list_specifications.find(i=>i.key_ids==s)||{}}console.log("已选的商品属性值 select_shuxing_list",this.select_shuxing_list),console.log("商品规格 select_specifications",{...this.select_specifications})},if_shuxing_list_contain(s){return!!this.select_shuxing_list.find(i=>i.id==s.id)},if_out_stock(s){let i=s.key,t=[];this.select_shuxing_list.forEach(e=>{e.id&&i!=e.key?t.push(e.id):i==e.key&&t.push(s.id)});let e=this.list_specifications.filter(s=>{let i=t.every(i=>s.key_ids.includes(i));return i}),c=!1;if(e.length>1)c=!1;else if(1==e.length){let s=e[0];c=!+s.kucun}else c=!0;return c},detail_action(s){if(console.log("======= detail_action 详情操作 =======",s),"首页"==s)this.$router.push("/");else if("购物车"==s)this.$router.push("/shoppingCart");else if("客服"==s)this.$refs.modalKefu.show=!0;else if("收藏"==s)this.onGood_collect(this.curr);else{var i=this.checkedSelected();if(!i)return;"加入购物车"==s?this.mix_shopcart_add_goods({inventoryId:this.select_specifications.inventoryId,add_num:this.selected_num}):"立即购买"==s&&this.payNow()}},checkedSelected(){return console.log("检测是否选择了商品",this.select_specifications),this.select_specifications.inventoryId?this.select_specifications.kucun<this.selected_num?(alert("该商品库存不足,无法购买"),!1):(this.show_sku=!1,!0):(alert("请选择商品规格"),!1)},payNow(){var s=this.curr;let{productId:i,images:t,title:e}=s,{inventoryId:c,key_vals:a,price_sale:n,price_market:o}=this.select_specifications,l=this.selected_num;var r=[{productId:i,image:t&&t[0],key_vals:a,title:e,num:l,inventoryId:c,price_sale:n,price_market:o}];sessionStorage.setItem("list_payment",JSON.stringify(r)),this.$router.push({path:"/orderCreate"})},onConfirm(){this.show=!1},previewModalImage(){ImagePreview([this.curr.images[0]])}}}),n=a,o=(t("aadd"),t("0b56")),l=Object(o["a"])(n,e,c,!1,null,"58563927",null);i["a"]=l.exports},aadd:function(s,i,t){"use strict";t("f641")},f641:function(s,i,t){}}]);