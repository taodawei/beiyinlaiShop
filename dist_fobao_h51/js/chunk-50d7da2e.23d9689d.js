(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50d7da2e"],{"4c67":function(t,s,e){},"50af":function(t,s,e){"use strict";e("4c67")},6156:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"page"},[s("modalOrderAddressSelect",{ref:"modalOrderAddressSelect"}),s("van-popup",{style:{height:"70%"},attrs:{round:"",closeable:"",position:"bottom"},model:{value:t.show_coupon,callback:function(s){t.show_coupon=s},expression:"show_coupon"}},[s("div",{staticClass:"coupon-wrap"},[s("div",{staticClass:"coupon-inner"},[s("div",{staticClass:"coupon-title"},[t._v("优惠详情")]),s("div",{staticClass:"coupon-title-2"},[t._v("优惠券")]),s("div",{staticClass:"coupon-list"},t._l(t.list_coupon,(function(e,i){return s("div",{key:i,staticClass:"coupon-item",class:{active:e.id==t.select_coupon.id}},[s("div",{staticClass:"left"},[s("span",{staticClass:"currency"},[t._v(" ￥ ")]),s("span",{staticClass:"mianzhi"},[t._v(" "+t._s(+e.jian)+" ")])]),s("div",{staticClass:"center"},[s("div",{staticClass:"title"},[t._v(t._s(e.title))]),s("div",{staticClass:"youxiaoqi"},[t._v(t._s(e.youxiaoqi))])]),s("div",{staticClass:"line"}),s("div",{staticClass:"right"},[s("div",{staticClass:"state",on:{click:function(s){return t.coupon_use(e)}}},[t._v(" "+t._s(e.id==t.select_coupon.id?"已选择":"立即使用")+" ")])])])})),0)]),s("div",{staticClass:"coupon-btn-box"},[s("button",{on:{click:t.notUseCoupon}},[t._v("不使用优惠券")])])])]),s("div",{staticClass:"inner"},[t.select_address.name?s("div",{staticClass:"address-detail",on:{click:t.chooseAddress}},[s("div",{staticClass:"icon-box"},[s("van-icon",{attrs:{name:"location-o"}})],1),s("div",{staticClass:"address-detail-info"},[s("div",{staticClass:"title"},[t._v(" 收货人："+t._s(t.select_address.name)+" "+t._s(t.select_address.phone)+" ")]),s("div",{staticClass:"text"},[s("span",{staticClass:"text-1"},[t._v(t._s(t.select_address.areaName))]),s("span",{staticClass:"text-2"},[t._v(t._s(t.select_address.address))])])]),s("van-icon",{attrs:{name:"arrow"}})],1):s("div",{staticClass:"address-detail",on:{click:t.chooseAddress}},[s("div",{staticClass:"icon-box"},[s("van-icon",{attrs:{name:"location-o"}})],1),s("div",{staticClass:"address-tip"},[t._v("请选择收货地址:")]),s("van-icon",{attrs:{name:"arrow"}})],1),t.tuan_type?s("div",{staticClass:"pintuan-box"},[s("div",{staticClass:"pintuan-title"},[t._v("您正在"+t._s(t.createType)+"购买")]),"开团"==t.createType?s("div",{staticClass:"pintuan-user"},[t._m(0),t._m(1)]):t._e(),"参团"==t.createType?s("div",{staticClass:"pintuan-user"},[t._l(t.tuan_info.team,(function(t,e){return s("div",{key:e,staticClass:"user-item"},[s("img",{attrs:{src:t.headimg,alt:""}})])})),s("div",{staticClass:"user-item"},[s("img",{attrs:{src:t.myAvatar,alt:""}})])],2):t._e()]):t._e(),s("div",{staticClass:"other-info"},[s("div",{staticClass:"info-title"},[t._v("商品信息")]),s("div",{staticClass:"goods-list"},t._l(t.list_payment,(function(e,i){return s("div",{key:i,staticClass:"item"},[s("div",{staticClass:"img-box"},[s("img",{attrs:{src:e.image,alt:""}})]),s("div",{staticClass:"info"},[s("div",{staticClass:"top"},[t._v(t._s(e.title))]),s("div",{staticClass:"center"},[s("span",[t._v(t._s(t._f("f_guige")(e.key_vals)))]),s("div",{staticClass:"priceBox"})]),s("div",{staticClass:"bottom"},[s("div",{staticClass:"price"},[s("span",{staticClass:"product-num"},[t._v("x "+t._s(e.num))]),s("span",{staticClass:"sale-price"},[t._v(" "+t._s(t.currency)+" "+t._s(t.tuan_type?e.price_tuan:e.price_sale))])])])])])})),0)]),s("div",{staticClass:"peisong-info"},[s("van-cell",{staticStyle:{"margin-bottom":"0"},attrs:{title:"配送服务",value:"快速运输"}}),s("van-field",{attrs:{readonly:"",colon:"",label:"订单备注",placeholder:"请填写备注信息"},on:{click:function(s){t.show_remark=!0}},scopedSlots:t._u([{key:"button",fn:function(){return[s("van-icon",{attrs:{name:"arrow"}})]},proxy:!0}]),model:{value:t.remark,callback:function(s){t.remark=s},expression:"remark"}})],1),s("div",{staticClass:"jiage-info"},[s("div",{staticClass:"jiage-title"},[t._v("价格明细")]),s("van-cell",{staticStyle:{"margin-bottom":"0"},attrs:{title:"商品总价",value:"￥"+t.payment_money}}),s("van-cell",{staticStyle:{"margin-bottom":"0"},attrs:{title:"运费",value:"免运费"}}),s("div",{staticClass:"heji-box"},[s("div",{staticClass:"text"},[t._v("合计：")]),s("div",{staticClass:"price"},[t._v("￥ "+t._s(t.payment_money))])])],1),t.list_coupon.length?s("div",{staticClass:"goods-action-info"},[s("div",{staticClass:"action-item",on:{click:t.open_coupon_modal}},[s("div",{staticClass:"left"},[t._v("优惠")]),s("div",{staticClass:"center"},[t.select_coupon&&t.select_coupon.id?s("div",{staticClass:"coupon-box"},[s("div",{staticClass:"tag-1"},[t._v("优惠券")]),s("div",{staticClass:"tag-2"},[t._v(t._s(t.select_coupon.miaoshu))])]):t._e()]),s("div",{staticClass:"right"},[s("span",{staticClass:"text"},[t._v("选择")]),s("van-icon",{attrs:{name:"arrow"}})],1)])]):t._e()]),s("div",{staticClass:"footer-box"},[s("div",{staticClass:"info"},[s("div",{staticClass:"text"},[t._v("合计:")]),s("div",{staticClass:"val"},[s("span",{staticClass:"currency"},[t._v(" ￥ ")]),t._v(" "+t._s(t.payment_money)+" ")])]),s("button",{staticClass:"btn",on:{click:t.submit_order}},[t._v("提交订单")])]),s("van-popup",{style:{height:"60%"},attrs:{round:"",closeable:"",position:"bottom"},model:{value:t.show_remark,callback:function(s){t.show_remark=s},expression:"show_remark"}},[s("div",{staticClass:"coupon-wrap remark-wrap"},[s("div",{staticClass:"coupon-inner"},[s("div",{staticClass:"coupon-title"},[t._v("订单备注")]),s("div",{staticClass:"input-box"},[s("van-field",{attrs:{rows:"2",autosize:{minHeight:120},type:"textarea",maxlength:"200",placeholder:"选填，填写您的需求，付款后商家可见","show-word-limit":""},model:{value:t.remark,callback:function(s){t.remark=s},expression:"remark"}})],1)]),s("div",{staticClass:"coupon-btn-box"},[s("button",{on:{click:t.confirm_remark}},[t._v("确定")])])])])],1)},a=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"user-item"},[s("img",{attrs:{src:e("7886"),alt:""}})])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"user-item"},[s("img",{attrs:{src:e("c568"),alt:""}})])}],o=(e("4e3f"),function(){var t=this,s=t._self._c;return s("div",{staticClass:"modal-address-container"},[s("van-popup",{style:{height:"80%"},attrs:{round:"",closeable:"",position:"bottom"},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[s("div",{staticClass:"address-wrap"},[s("div",{staticClass:"address-inner"},[s("div",{staticClass:"address-title"},[t._v("收货地址")]),s("div",{staticClass:"address-title-2"},[t._v("地址列表")]),s("div",{staticClass:"address-list"},t._l(t.list_address,(function(e,i){return s("div",{key:i,staticClass:"address-item"},[s("div",{staticClass:"left"},[s("div",{staticClass:"title"},[t._v(t._s(e.name)+" "+t._s(e.phone))]),s("div",{staticClass:"youxiaoqi"},[t._v(t._s(e.areaName)+" "+t._s(e.address))])]),s("div",{staticClass:"line"}),s("div",{staticClass:"right"},[s("div",{staticClass:"state",on:{click:function(s){return t.addressChoose(e)}}},[t._v("选择")])])])})),0)]),s("div",{staticClass:"address-btn-box"},[s("div",{staticClass:"add-box"},[s("button",{on:{click:function(s){return t.toRoute("/myAddressAdd")}}},[t._v("新增地址")])]),s("div",{staticClass:"queding-box"},[s("button",{on:{click:function(s){t.show=!1}}},[t._v("确定")])])])])])],1)}),n=[],r={name:"modal-order-address-select",data(){return{show:!1,list_address:[]}},computed:{optsAddress(){let t=[];return t=this.list_address.map(t=>({...t,name:t.name,subname:t.areaName+" "+t.address})),t}},watch:{show(t){}},methods:{init(t){this.show=!0,this.list_address=t,console.log("地址列表",t)},addressChoose(t){this.show=!1,this.$parent.addressSelectCallback(t)},onConfirm(){this.$api("gouwuche_updateNum",{inventoryId:this.item.inventoryId,num:this.item.num}).then(t=>{let{code:s,count:e}=t;1==s&&(this.$parent.childComponentSuccessCallback({name:"modalShoppingCartUpdateNumber",data:this.item}),this.$store.commit("set_shopcart_count",e),this.show=!1)})}}},c=r,d=(e("50af"),e("0b56")),l=Object(d["a"])(c,o,n,!1,null,"fe3dd976",null),u=l.exports,p=e("36fc"),_=e("7736"),h={name:"order-create",components:{modalOrderAddressSelect:u},data(){return{tuan_id:this.$route.query.tuan_id||"",createType:this.$route.query.createType||"",tuan_type:"开团"==this.$route.query.createType||"参团"==this.$route.query.createType?1:"",tuan_info:{},list_address:[],list_payment:[],list_coupon:[],select_coupon:"",order_price:0,show_coupon:!1,select_coupon:{},shequ_id:"",currency:"￥",sendType:"配送",orderMoney:0,list:[],totalMoney:0,order_id:"",remark:"",show_remark:!1,select_address:{}}},computed:{...Object(_["b"])(["if_calc_yunfei","webConfig"]),payment_money(){let t=0;return this.order_price&&(t=1*this.order_price),this.select_coupon.id&&(t-=this.select_coupon.jian),console.log(t,"金额"),t<0&&(t=0),t.toFixed(2)}},watch:{default_address(t){this.select_address=t},select_address(){this.if_calc_yunfei&&this.orders_getPayInfo()}},created(){this.setView()},methods:{setView(){this.get_list_payment(),this.mix_address_list(),this.if_calc_yunfei||this.orders_getPayInfo(),"参团"==this.createType&&this.query_goods()},get_list_payment(){console.log("待付款商品 list_payment",JSON.parse(sessionStorage.getItem("list_payment"))),this.list_payment=JSON.parse(sessionStorage.getItem("list_payment"))},query_goods(){let t=this.list_payment[0]||{},s=t.inventoryId;this.$api("product_detail",{inventoryId:s}).then(t=>{let{code:s,data:e}=t;1==s&&(this.tuan_info=e.tuangou_activity.list.find(t=>t.tuan_id==this.tuan_id))})},orders_getPayInfo(){let t=sessionStorage.getItem("list_payment"),s=JSON.parse(t),e=s.map(t=>({inventoryId:t.inventoryId,productId:t.productId,num:t.num}));e=JSON.stringify(e),this.$api("orders_getPayInfo",{address_id:this.select_address.id||"",product_info:e,tuan_id:this.tuan_id,tuan_type:this.tuan_type}).then(t=>{let{code:s,data:e,message:i}=t;1==s&&(console.log("根据下单商品获取确认订单信息",e),e.yhq_list.length&&(this.list_coupon=e.yhq_list.map(t=>({...t,miaoshu:+t.man?`满${+t.man}减${+t.jian}元`:`下单立减${+t.jian}元`,youxiaoqi:t.startTime.substr(0,10)+" - "+t.endTime.substr(0,10)}))),this.order_price=e.order_price)})},onClickLeft(){this.$route.query&&this.$route.query.wxshare?this.$router.push("/"):this.$router.back()},chooseAddress(){this.list_address.length>1?(this.showAddress=!0,this.mix_openModal("modalOrderAddressSelect",this.list_address)):this.$router.push({path:"/myAddress"})},addressSelectCallback(t){console.log("父组件接收 地址选择",{...t}),this.select_address=t},submit_order(){if(console.log("select_coupon",this.select_coupon),!this.select_address.id)return void alert("请选择收货地址");let t=this.list_payment.map(t=>({inventoryId:t.inventoryId,productId:t.productId,num:t.num,shequ_id:t.shequ_id})),s={address_id:this.select_address.id,product_info:JSON.stringify(t),remark:this.remark,tuan_id:this.tuan_id,tuan_type:this.tuan_type,yhq_id:this.select_coupon.id||""};this.$api("orders_create",{...s}).then(t=>{let{code:s,data:e,order_id:i}=t;1==s&&(this.order_id=i,"shoppingCart"==this.$route.query.from&&this.shopcart_delete_payment(),this.$router.push({path:"/orderPaymentMethod",query:{order_id:i}}))})},orderPayWxJsapi(t){this.$api("orders_wxPay",{order_id:t,code:this.wx_code}).then(s=>{let{code:e,data:i,message:a}=s;if(1==e){i=JSON.parse(i),console.log("订单微信jsapi支付",i);let{timeStamp:s,nonceStr:e,signType:a,paySign:o}=i;wx.chooseWXPay({timestamp:s,nonceStr:e,package:i.package,signType:a,paySign:o,success:function(s){alert("支付成功"),taht.$router.push({path:"/orderPaymentSuccess",query:{id:t}})},fail(t){console.log("支付失败了"),alert("支付失败")}})}else alert(a)})},shopcart_delete_payment(){let t=this.list_payment.map(t=>t.inventoryId),s=t.join();this.mix_shopcart_delete(s,1)},compare_jifen(){let t=this.baseInfo.jifen,s=this.orderMoney/100,e=t>=s;e?p["a"].confirm({title:"信息提示",message:`本次兑换需要${s}积分 您的积分为${t}`}).then(()=>{this.use_jifen()}).catch(()=>{}):p["a"].confirm({title:"您的积分不足",message:`本次兑换需要${s}积分，您的积分为${t}，无法兑换该商品。`}).then(()=>{}).catch(()=>{})},use_jifen(){var t=this.product_info.map(t=>t.inventoryId).join();let s=this.product_info[0].num;this.$api("money_jifenOrder",{inventoryId:t,num:s,address_id:this.select_address.id,is_ziti:"自提"==this.sendType?1:0}).then(t=>{console.log("积分下单结果",t);let{code:s,order_id:e,message:i}=t;alert(i),1==s&&this.$router.push({path:"/orderPaymentSuccess",query:{id:e}})})},open_coupon_modal(){this.show_coupon=!0},coupon_use(t){this.select_coupon=t,this.show_coupon=!1},notUseCoupon(){this.select_coupon={},this.show_coupon=!1},confirm_remark(){this.show_remark=!1}}},m=h,v=(e("6d9c"),Object(d["a"])(m,i,a,!1,null,"cebb55b6",null));s["default"]=v.exports},"6d9c":function(t,s,e){"use strict";e("7cb5")},7886:function(t,s,e){t.exports=e.p+"img/pintuan-pay-user.0ed57920.png"},"7cb5":function(t,s,e){},c568:function(t,s){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA9CAYAAAAeYmHpAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAASDSURBVGhD7dkHb6w4FIbh/f9/Lr0nN7333uPVg+IIjXYAG5O70swnIZiJMec9zWbyT5hATaEnRVPoSdEUelI0hZ4UDQr99vYW7u/vqyPq+vo6nJ+fV+eXl5fw9fVVjXP9+fn5PWpYFYVm9OPjY3h/f/+BeXh4CM/Pz98jQnh9fa0+O398fFT3AL69vf1xQjyGUjFoRjL67u6uAvIZEAc0RdA48BwRneVadphvCPWCBiOaEdKZoSB8zhVoznt6euo1zzj1ggbJOClcWhwancexjlIOyIKOD49pKC2HEnDP0PhKPScLmteb6rS0OBk4B5RQMrQ6u7q6GqzJjFPMrrbG2EVZ0IB/M9J1WRJFXT/JVWdonnbkdGYOUv8ansbnYDgHpqas0nLf4NCMFl1HCnBsQicnJ2F3dzf8+fMnbG5uhq2trep6Z2cnHB0dVU0qBd7YVGfV1Qmad+2YRKsrtNoDA25+fj7MzMyEhYWFsLKyEpaXl6vr2dnZMDc3F9bX16utacqyBFq0c+A7QQOQml0NkhmANzY2Klhga2trYX9/v4I7OzsLe3t71XfRIc7+1nVZinsEqZ6qVmigKSlNMkKEIzB439VlTkZvb29XETdWBmhUXVTvE6lqhebRVG+KJAAgUhfcODFaxI11yJChV4ZGaA9nlHpOkaYlXUVQJJsgOPXg4OAHOiXFZUus7ZRsbIU2oSNFujNgzerw8PD72/+WuXXwCC1LNLQuYp8V5ebmJik7GqFjPad4kRghYpeXl601qi4tXRHaPV07Mrs4qCi0NHOkQncVOFvaWP9KQv2nPC9GO+WeRmhRUtMpXuwqwCIUu3ys/9Eu30XmKgZtN+UoHWlO1Bzry9rq6mqWg413X0pGNkLzYNf6ShEj6xEGLMI5zmWfPpCS4o3QQ0hE6kuadVwZ5WaT+wAXi7RNCYNKRvv4+DgsLS1VUQZcYjMCNsVpjdBxY9J13WyTNdmWVISBe/sSoT7isNS+0wgNVuqUiDSjRDVGWafuus8eJ3Ny5MXFRVK2tNZ0auqME6NEdnFxsYKW5iXSGrRsTLGxFVr6mbgvuPvt0rxciLbolJB5UzOxFVoK2jX1TXHGmQus/XXf1CZz5mRLK7QoaxSlmlkpgbW6CEiqOtW0Bzj/nyQIgpGTMa3QBFht5+6ayH2M1MC8brruI/MpuUHSmzxAmqe89o2KcRqZLacO7jpXotyn3DpBk0hbGvpA15es09PT77+kKaZ1zg+CUZ2hKQLn1LjxXiX9Cmpj4jpHNkt2is65SoKOUtsl1u4UcXR0dt/nZkFLL6kO/DcEUpfmbOB9lQXNiHrnHDLi5pbKGl+pvUIWdFQ0yItEzs88TeJQjvUMB+BSzu0FTbq61IubhFh3fQQw/mezRDqPqjc0QBGJ78UizlgZ0NVg49wXazZuhMxRKrp19YYeFUNFKQJwSPwFJgJogD7HRmiMxui7ISI7quLQxPAIKFUBeTGI31lnfXYm4zlGhIeI7KgGgW4TyN+I6Dj9Fei/rSn0pGgKPSmaQk+KJhA6hH8B0A6dEgjJe0QAAAAASUVORK5CYII="}}]);